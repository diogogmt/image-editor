<!DOCTYPE html>
<html>
<head>
  <title>Stack</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #e5e5e5;
    }
    #glibcanvas {
      width: 800px;
      height: 800px;
    }
  </style>
</head>
<body>
<script src="../libs/jquery.min.js"></script>
<script src="../libs/processing-1.3.6.js"></script>
<script src="../libs/Base.js"></script>

<div id="wrapper">

    <button id="start">Start</button>
    <button id="stop">Stop</button>
    <button id="do">Do</button>
    <button id="undo">Undo</button>
    <button id="rect">Rect</button>
    <button id="color">Change Color</button>

    <br />
    <br />


    <canvas id="glibcanvas"></canvas>

</div>

<script>
  const RECT = 1;

  const DEFAULT = 1
  , MOVE = 2
  , CREATE = 3
  , RESIZE = 4;

  const CTRL_KEY = 17;

  window.Utils = {};

</script>

<script src="commands.js"></script>
<script src="color.js"></script>
<script src="shapeFactory.js"></script>
<script src="shapes.js"></script>
<script src="rect.js"></script>
<script src="defaultState.js"></script>
<script src="createState.js"></script>
<script src="resizeState.js"></script>
<script src="moveState.js"></script>
<script src="undoManager.js"></script>
<script src="canvas.js"></script>
<script src="controller.js"></script>

<script>
  $(document).ready(function () {
    $("#start").click(function (e) {
      pjs.loop();
    });

    $("#stop").click(function (e) {
      pjs.noLoop();
    });

    $("#do").click(function (e) {
      console.log("redo click");
      Utils.UndoManager.getInstance().redo();
    });

    $("#undo").click(function (e) {
      console.log("undo click");
      Utils.UndoManager.getInstance().undo();
    });

    $("#rect").click(function (e) {
      console.log("rect click listener");
      controller.perform("setCanvasState", [CREATE,RECT]);
    });

    $("#color").click(function (e) {
      console.log("color click");
      controller.perform("setColor", [Utils.generateColor()]);
    });

    var c = document.getElementById('glibcanvas');
    pjs = new Processing(c);

    var canvas = Utils.Canvas.getInstance();
    var controller = Utils.Controller.getInstance();
    pjs.setup = function() {
      pjs.size(800, 800);
      pjs.frameRate(200);
      pjs.stroke("#003300");
      pjs.fill("#0000FF");
      var fontA = pjs.loadFont("Arial");
      pjs.textFont(fontA, 20);
    }

    pjs.draw = function() {
      // console.log("pjs draw");
      pjs.background(255, 255, 255);
      canvas.draw();
    };

    pjs.mousePressed = function () {
      canvas.mousePressed();
    },

    pjs.mouseDragged = function () {
      canvas.mouseDragged();
    },

    pjs.mouseReleased = function () {
      canvas.mouseReleased();
    },

    pjs.mouseMoved = function () {

    },

    pjs.keyReleased = function () {
      console.log("pjs - keyReleased");
      pjs.keyCode = null;

      console.log("keyCode: ", pjs.keyCode);
    },
    pjs.setup();



  });
</script>

</body>
</html>
